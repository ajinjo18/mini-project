<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shorcket icon" type="x-icon" href="/img/logo2.png">
    <title>GO shop</title>    <link rel="stylesheet" href="/css/home/profileedit.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://public.easyinvoice.cloud/js/easyinvoice.min.js"></script>
  </head>

<body>

  <style>
    @import url('https://fonts.googleapis.com/css?family=Open+Sans&display=swap');body{background-color: #eeeeee;font-family: 'Open Sans',serif}.container{margin-top:50px;margin-bottom: 50px}.card{position: relative;display: -webkit-box;display: -ms-flexbox;display: flex;-webkit-box-orient: vertical;-webkit-box-direction: normal;-ms-flex-direction: column;flex-direction: column;min-width: 0;word-wrap: break-word;background-color: #fff;background-clip: border-box;border: 1px solid rgba(0, 0, 0, 0.1);border-radius: 0.10rem}.card-header:first-child{border-radius: calc(0.37rem - 1px) calc(0.37rem - 1px) 0 0}.card-header{padding: 0.75rem 1.25rem;margin-bottom: 0;background-color: #fff;border-bottom: 1px solid rgba(0, 0, 0, 0.1)}.track{position: relative;background-color: #ddd;height: 7px;display: -webkit-box;display: -ms-flexbox;display: flex;margin-bottom: 60px;margin-top: 50px}.track .step{-webkit-box-flex: 1;-ms-flex-positive: 1;flex-grow: 1;width: 25%;margin-top: -18px;text-align: center;position: relative}.track .step.active:before{background: #FF5722}.track .step::before{height: 7px;position: absolute;content: "";width: 100%;left: 0;top: 18px}.track .step.active .icon{background: #ee5435;color: #fff}.track .icon{display: inline-block;width: 40px;height: 40px;line-height: 40px;position: relative;border-radius: 100%;background: #ddd}.track .step.active .text{font-weight: 400;color: #000}.track .text{display: block;margin-top: 7px}.itemside{position: relative;display: -webkit-box;display: -ms-flexbox;display: flex;width: 100%}.itemside .aside{position: relative;-ms-flex-negative: 0;flex-shrink: 0}.img-sm{width: 80px;height: 80px;padding: 7px}ul.row, ul.row-sm{list-style: none;padding: 0}.itemside .info{padding-left: 15px;padding-right: 7px}.itemside .title{display: block;margin-bottom: 5px;color: #212529}p{margin-top: 0;margin-bottom: 1rem}.btn-warning{color: #ffffff;background-color: #ee5435;border-color: #ee5435;border-radius: 1px}.btn-warning:hover{color: #ffffff;background-color: #ff2b00;border-color: #ff2b00;border-radius: 1px}
  </style>

    <style>
        .gradient-custom-2 {
/* fallback for old browsers */
background: #a1c4fd;

/* Chrome 10-25, Safari 5.1-6 */
background: -webkit-linear-gradient(to right, rgba(161, 196, 253, 1), rgba(194, 233, 251, 1));

/* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
background: linear-gradient(to right, rgba(161, 196, 253, 1), rgba(194, 233, 251, 1))
}

#progressbar-1 {
color: #455A64;
}

#progressbar-1 li {
list-style-type: none;
font-size: 13px;
width: 33.33%;
float: left;
position: relative;
}

#progressbar-1 #step1:before {
content: "1";
color: #fff;
width: 29px;
margin-left: 22px;
padding-left: 11px;
}

#progressbar-1 #step2:before {
content: "2";
color: #fff;
width: 29px;
}

#progressbar-1 #step3:before {
content: "3";
color: #fff;
width: 29px;
margin-right: 22px;
text-align: center;
}

#progressbar-1 li:before {
line-height: 29px;
display: block;
font-size: 12px;
background: #455A64;
border-radius: 50%;
margin: auto;
}

#progressbar-1 li:after {
content: '';
width: 121%;
height: 2px;
background: #455A64;
position: absolute;
left: 0%;
right: 0%;
top: 15px;
z-index: -1;
}

#progressbar-1 li:nth-child(2):after {
left: 50%
}

#progressbar-1 li:nth-child(1):after {
left: 25%;
width: 121%
}

#progressbar-1 li:nth-child(3):after {
left: 25%;
width: 50%;
}

#progressbar-1 li.active:before,
#progressbar-1 li.active:after {
background: #1266f1;
}

.card-stepper {
z-index: 0
}
    </style>
    <style>
        .gradient-custom {
        /* fallback for old browsers */
        background: #cd9cf2;

        /* Chrome 10-25, Safari 5.1-6 */
        background: -webkit-linear-gradient(to top left, rgba(205, 156, 242, 1), rgba(246, 243, 255, 1));

        /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
        background: linear-gradient(to top left, rgba(205, 156, 242, 1), rgba(246, 243, 255, 1))
        }
    </style>

<style>
  h1 {
  font-family: 'Montserrat', sans-serif;
  color: #fff;
}

/* You just need to get this field - start */

.search-box {
  max-width: 350px; /* Set a maximum width to avoid it becoming too wide on larger screens */
  width: 100%;
  position: relative;
  display: flex;
  margin: 0 auto;
}

.search-input {
  width: 100%;
  font-family: 'Montserrat', sans-serif;
  font-size: 16px;
  padding: 15px;
  background-color: #afafc2;
  color: #6c6c6c;
  border-radius: 6px;
  border: none;
  transition: all .4s;
}

.search-input:focus {
  border: none;
  outline: none;
  box-shadow: 0 1px 12px #b8c6db;
  -moz-box-shadow: 0 1px 12px #b8c6db;
  -webkit-box-shadow: 0 1px 12px #b8c6db;
}

.search-btn {
  background-color: transparent;
  font-size: 18px;
  padding: 6px 9px;
  margin-left: -45px;
  border: none;
  color: #6c6c6c;
  transition: all .4s;
  z-index: 10;
}

.search-btn:hover {
  transform: scale(1.2);
  cursor: pointer;
  color: black;
}

.search-btn:focus {
  outline: none;
  color: black;
}

/* Media query for smaller screens */
@media (max-width: 768px) {
  .search-box {
    max-width: 100%; /* Allow it to take the full width on smaller screens */
  }

  .search-btn {
    margin-left: 0; /* Center the button on smaller screens */
  }
}

</style>
    
    <div class="container-xl px-4 mt-4">
        <!-- Account page navigation-->
        <nav class="nav nav-borders">
            <a class="nav-link ms-0" href="/home/profile" >Profile</a>
            <a class="nav-link" href="/home/address" >Billing</a>
            <a class="nav-link" href="/home/wallet">Wallet</a>
            <a class="nav-link active" href="/home/orders" >Orders</a>
            <!-- <a class="nav-link" href="/home/editpassword" target="__blank">Security</a> -->
            <a class="nav-link" href="/" >Home</a>
        </nav>
        <hr class="mt-0 mb-4">
        <div class="row">
            <section class="h-100 gradient-custom">
              <!-- You just need to get this field. Start -->
<script src="https://kit.fontawesome.com/d97b87339f.js" crossorigin="anonymous"></script>

<!-- <div style="margin-top: 50px;" class="search-box">
  <input onkeyup="sendData(this)" name="name" class="search-input" type="text" placeholder="Search something..">
  <button type="submit" class="search-btn"><i class="fas fa-search"></i></button>
</div>

<section id="searchresult"></section> -->

<div style="margin-top: 50px;" class="search-box">
  <input onkeyup="sendData(this)" name="name" class="search-input" type="text" placeholder="Search something..">
  <button type="submit" class="search-btn"><i class="fas fa-search"></i></button>
</div>

<section id="searchresult"></section>


  

<!-- You just need to get this field. End -->
                <div class="container py-5 h-100">
                  <div class="row d-flex justify-content-center align-items-center h-100">
                    <div class="col-lg-10 col-xl-8">
                      <div class="card" style="border-radius: 10px;">
                        <% let index = 0; %>
                        <% orders.forEach(function(order) { %>
                          
                            <div class="card-body p-4">
                          <div class="card shadow-0 border mb-4">
                            <div class="card-body">
                              <div class="row">
                                <div style="text-align: end;">
                                  <i onclick="invoice('<%= order._id %>')" type="button" class="fas fa-file-pdf"></i>
                                  <!-- <button style="width:150px; height: 50px; margin-top: 25px; " onclick="invoice('<%= order._id %>')">INVOICE</button> -->
                                </div>
                                <div class="col-md-2">
                                  <img width="60px" src="<%= order.images %>"
                                    class="img-fluid">
                                </div>
                                  <div class="col-md-2 text-center d-flex justify-content-center align-items-center">
                                    <a style="text-decoration: none; color: black;" href="/home/productview/<%= order.productid %>"><%= order.productName %></a>
                                  </div>
                                  <div class="col-md-2 text-center d-flex justify-content-center align-items-center">
                                    <p class="text mb-0 small">Qty: <%= order.quantity %></p>
                                  </div>
                                  <div class="col-md-2 text-center d-flex justify-content-center align-items-center">
                                    <p class=" mb-0 small">total: <i style="color: red;"><%= order.totalprice %></i></p>
                                    <p hidden><%= order.productid %></p>
                                  </div>
                                  <% if (order.status === 'Cancelled') { %>
                                    <div class="d-flex justify-content-end align-items-end">
                                      <p class="text mb-0 small">status: <i style="color: red;"><%= order.status %></i></p>
                                    </div>
                                  <% } else { %>
                                    <div class="d-flex justify-content-end align-items-end">
                                      <p class="text mb-0 small">status: <i style="color: rgb(36, 150, 36);"><%= order.status %></i></p>
                                    </div>
                                  <% } %>
                              </div>
                              <hr class="mb-4" style="background-color: #e0e0e0; opacity: 1;">
                              <div style="margin-top: -15px;" class="row d-flex align-items-center">
                                 <div>
                                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal<%= index %>">
                                    Order Details
                                </button>

                                
                                
                                <!-- Modal -->
                                <div class="modal fade" id="exampleModal<%= index %>" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                        <h1 class="modal-title fs-5" id="exampleModalLabel">Order Details</h1>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="card card-stepper" style="border-radius: 16px;">
                                                <div class="card-header p-4">
                                                  <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                      <p class="text-muted mb-2"> Order ID <span class="fw-bold text-body"><%= order.id %></span></p>
                                                      <p class="text-muted mb-0"> Place On <span class="fw-bold text-body"><%= order.date %></span> </p>
                                                    </div>
                                                  </div>
                                                </div>
                                                <div class="card-body p-4">
                                                  <div class="d-flex flex-row mb-4 pb-2">
                                                    <div class="flex-fill">
                                                      <h5 class="bold"><%= order.productName %></h5>
                                                      <p class="text-muted"> Qt: <%= order.quantity %></p>
                                                      <h4 class="mb-3"><%= order.totalprice %><span class="small text-muted"> via (<%= order.payment %>) </span></h4>
                                                      <!-- <p class="text-muted">Tracking Status on: <span class="text-body">11:30pm, Today</span></p> -->
                                                    </div>
                                                    <div>
                                                      <img class="align-self-center img-fluid"
                                                        src="<%= order.images %>" width="70">
                                                    </div>
                                                  </div>

                                                  <div class="track">
                                                    <% if (order.status == 'Pending') { %>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-spinner"></i> </span> <span class="text">Pending</span> </div>
                                                      <div class="step "> <span class="icon"> <i class="fas fa-check"></i> </span> <span class="text">Shipped</span> </div>
                                                      <div class="step "> <span class="icon"> <i class="fas fa-truck"></i> </span> <span class="text">Out for delivery</span> </div>
                                                      <div class="step"> <span class="icon"> <i class="fas fa-box"></i> </span> <span class="text">Delivered</span> </div>
                                                    <% } else if (order.status == 'Shipped') { %>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-spinner"></i> </span> <span class="text">Pending</span> </div>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-check"></i> </span> <span class="text">Shipped</span> </div>
                                                      <div class="step "> <span class="icon"> <i class="fas fa-truck"></i> </span> <span class="text">Out for delivery</span> </div>
                                                      <div class="step"> <span class="icon"> <i class="fas fa-box"></i> </span> <span class="text">Delivered</span> </div>
                                                    <% } else if(order.status == 'Out for delivery') { %>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-spinner"></i> </span> <span class="text">Pending</span> </div>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-check"></i> </span> <span class="text">Shipped</span> </div>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-truck"></i> </span> <span class="text">Out for delivery</span> </div>
                                                      <div class="step"> <span class="icon"> <i class="fas fa-box"></i> </span> <span class="text">Delivered</span> </div>
                                                    <% } else if(order.status == 'Delivered') { %>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-spinner"></i> </span> <span class="text">Pending</span> </div>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-check"></i> </span> <span class="text">Shipped</span> </div>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-truck"></i> </span> <span class="text">Out for delivery</span> </div>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-box"></i> </span> <span class="text">Delivered</span> </div>
                                                      <% } else if(order.status =='Return rejected') { %>
                                                        <div class="step active"> <span class="icon"> <i class="fas fa-spinner"></i> </span> <span class="text">Pending</span> </div>
                                                        <div class="step active"> <span class="icon"> <i class="fas fa-check"></i> </span> <span class="text">Shipped</span> </div>
                                                        <div class="step active"> <span class="icon"> <i class="fas fa-truck"></i> </span> <span class="text">Out for delivery</span> </div>
                                                        <div class="step active"> <span class="icon"> <i class="fas fa-box"></i> </span> <span class="text">Delivered</span> </div>                                                     <% } else { %>
                                                      <div class="step active"> <span class="icon"> <i class="fas fa-times"></i> </span> <span class="text">Cancelled</span> </div>
                                                    <% } %>
                                                </div>
                                                
                                                </div>
                                                <div class="card-footer p-4">
                                                  <div class="d-flex justify-content-between">
                                                    <% if (order.status != 'Cancelled' && order.status != 'Delivered' && order.status != 'Return Pending' && order.status !='Return rejected' && order.status != 'Return successfully' ) { %>
                                                    <h5 class="fw-normal mb-0"><a style="text-decoration: none; cursor: pointer;" onclick="checker('/home/cancelorder/<%= order._id %>?productname=<%= order.productName %>&payment=<%= order.payment %>&amount=<%= order.totalprice %>&orderid=<%= order.id %>')">Cancel Order</a></h5>
                                                    <% } %>
                                                    <% if (order.status == 'Delivered') { %>
                                                      <h5 class="fw-normal mb-0"><a style="text-decoration: none; cursor: pointer;" onclick="checker1('/home/return/<%= order._id %>?productname=<%= order.productName %>&payment=<%= order.payment %>&amount=<%= order.totalprice %>&orderid=<%= order.id %>')">Return Order</a></h5>
                                                    <% } %>
                                                  
                                                    <div class="border-start h-100"></div>
                                                    <!-- <h5 class="fw-normal mb-0"><a href="#!">Cancel</a></h5> -->
                                                    <div class="border-start h-100"></div>
                                                    <!-- <h5 class="fw-normal mb-0"><a href="#!">Pre-pay</a></h5> -->
                                                    <div class="border-start h-100"></div>
                                                    <!-- <h5 class="fw-normal mb-0"><a href="#!" class="text-muted"><i class="fas fa-ellipsis-v"></i></a>
                                                    </h5> -->
                                                  </div>
                                                </div>
                                              </div>
                                        </div>
                                        <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                        </div>
                                    </div>
                                    </div>
                                </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <% index++; %>
                        <% }); %>
                      </div>
                    </div>
                  </div>
                </div>
                <nav aria-label="...">
                  <ul class="pagination pagination-lg">
                    <ul class="pagination">
                      <% if(pages) { %>
                        <% const totalPages = Math.ceil(pages); %>
                        <% const maxPagesToShow = 5; %>
                        <% const startPage = Math.max(0, pagenum - Math.floor(maxPagesToShow / 2)); %>
                        <% const endPage = Math.min(totalPages - 1, startPage + maxPagesToShow - 1); %>
                    
                        <% if (startPage > 0) { %>
                          <li class="page-item">
                            <a class="page-link" href="/home/orderspage?page=<%= startPage - 1 %>" tabindex="-1">Previous</a>
                          </li>
                        <% } %>
                    
                        <% for(let i = startPage; i <= endPage; i++) { %>
                          <% if (pagenum === i) { %> 
                            <li class="page-item active">
                              <a class="page-link" href="/home/orderspage?page=<%= i %>" tabindex="-1"><%= i + 1 %></a>
                            </li>
                          <% } else { %> 
                            <li class="page-item">
                              <a class="page-link" href="/home/orderspage?page=<%= i %>" tabindex="-1"><%= i + 1 %></a>
                            </li>
                          <% } %>
                        <% } %>
                    
                        <% if (endPage < totalPages - 1) { %>
                          <li class="page-item">
                            <a class="page-link" href="/home/orderspage?page=<%= endPage + 1 %>" tabindex="-1">Next</a>
                          </li>
                        <% } %>
                    
                      <% } %>
                    </ul>
                    
                  </ul>
                </nav>
              </section>           
        </div>
    </div>


    <script>
      async function invoice(orderId) {
          try {
              const response = await fetch(`/home/myinvoice/${orderId}`);
              if (response.ok) {
                  const blob = await response.blob();
                  const url = window.URL.createObjectURL(blob);
                  const a = document.createElement('a');
                  a.href = url;
                  a.download = 'invoice.pdf';
                  a.click();
                  window.URL.revokeObjectURL(url);
              } else {
                  console.error('Error generating PDF');
              }
          } catch (error) {
              console.error(error);
          }
      }
  </script>
  


<!-- <script>
async function invoice(id) {
  try {
    const response = await fetch(`/home/myinvoice/${id}`, { method: 'get' });

    if (!response.ok) {
      throw new Error(`Fetch request failed with status: ${response.status}`);
    }

    const data = await response.json();

 

    let data1 = {

      "currency": "INR",
      "taxNotation": "",
      "marginTop": 25,
      "marginRight": 25,
      "marginLeft": 25,
      "marginBottom": 25,
      "logo": "https://public.easyinvoice.cloud/img/logo_en_original.png",
      "background": "https://public.easyinvoice.cloud/img/watermark-draft.jpg",
      "sender": {
        "company": "GOshop",
        "address": "GOshop",
        "zip": "695502",
        "city": "Trivandrum",
        "country": "India"

      },
      "client": {
        "company": data.username,
        "address": data.address,
        "zip": data.pincode,
        "city": data.city,
        "country": "India"

      },
      "invoiceNumber": "2021.0001",
      "invoiceDate": "1.1.2021",
      "products": [
        {
          "product Name": data.productName,
          "quantity": data.quantity,
          "description": data.productName,
          "tax-rate": 0,
          "price": data.price,
          "Shipping": 40
        },

      ],
      "bottomNotice": "Your invoice for the product",

    };


easyinvoice.createInvoice(data1, function (result) {
      easyinvoice.download('myInvoice.pdf', result.pdf);
    //	you can download like this as well:
    //	easyinvoice.download();
    //	easyinvoice.download('myInvoice.pdf');   
    });
  } catch (error) {
    console.error(error);
  }
}

</script> -->





<script>
  
  const url='/home/search'
  function sendData(e){
    const searchresult =document.getElementById('searchresult')
  let match=e.value.match(/^[a-zA-Z ]*/);
  let match2=e.value.match(/\s*/);
  if(match2[0]===e.value){
    searchresult.innerHTML='';
    return;
  }
  if(match[0]===e.value){
    fetch(url,{
      method:'post',
      headers: {'Content-Type': 'application/json'},
      body:JSON.stringify({payload:e.value})

    }).then(res=> res.json())
    .then(data=>{
      let payload = data.payload
      searchresult.innerHTML='';
      if(payload.length < 1){
        searchresult.innerHTML='<p>Sorry. Nothing Found.</p>'
        return;
      }
      payload.forEach((item,index)=>{
        if(index>0) searchresult.innerHTML += '<hr>';
        searchresult.innerHTML += `<a style="text-decoration: none;" href="/home/ordersearch/:${item._id}"><img src="${item.images}" width="40px" alt="Product Image">${item.productName}(${item.date})</a>`;
        
      })
    })
    return;
  }
  searchresult.innerHTML='';
    
  }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
<script src="https://unpkg.com/easyinvoice/dist/easyinvoice.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<script>

  function checker(url) {
    swal({
      title: "Cancel Order",
      text: "Are You Sure You Want To Cancel Order?",
      icon: "warning",
      buttons: true,
      dangerMode: true,
    }).then((willDelete) => {
      if (willDelete) {
        window.location.href=url
      }
    });
  }
  
</script>


<script>

  function checker1(url) {
    swal({
      title: "Return Order",
      text: "Are You Sure You Want To Return Order?",
      icon: "warning",
      buttons: true,
      dangerMode: true,
    }).then((willDelete) => {
      if (willDelete) {
        window.location.href=url
      }
    });
  }
  
</script>

  </body>
</html>